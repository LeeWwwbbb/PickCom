<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board">
    <!-- 게시글 리스트 검색 -->
    <select id="selectBoardList" parameterType="hashmap" resultType="hashmap">
        <include refid="common.pagingPre"/>
        SELECT
        ROW_NUMBER() over (ORDER BY b.board_num DESC) rnum,
        TO_CHAR(b.board_createdDate, 'YYYY.MM.DD') AS board_createDate,
        b.*, m.member_name, COUNT(l.like_num) AS like_count FROM board b
        LEFT JOIN member m ON b.member_num = m.member_num
        LEFT JOIN `like` l ON b.board_num = l.board_num
        WHERE b.board_cate = #{cate}
        GROUP BY b.board_num ORDER BY b.board_num DESC
        <include refid="common.pagingPost"/>
    </select>

    <select id="boardList" parameterType="hashmap" resultType="hashmap">
        <![CDATA[
            SELECT *
            FROM board
        ]]>
    </select>

    <!-- 글 검색 -->
    <select id="openBoardDetail" parameterType="hashmap" resultType="hashmap">
        SELECT *
        FROM board
        WHERE board_num = #{board_num}
    </select>

    <!-- 댓글 리스트 출력 -->
    <select id="selectCommentList" parameterType="hashmap" resultType="hashmap">
        <![CDATA[
        SELECT c.*
        FROM comment c
                 INNER JOIN board b ON c.board_num = b.board_num
        WHERE b.board_num = #{board_num}
        ]]>
    </select>

    <!-- 게시글 검색 -->
    <select id="selectBoardDetail" parameterType="hashmap" resultType="hashmap">
        <include refid="common.pagingPre"/>
        SELECT
        ROW_NUMBER() over (ORDER BY board_num DESC) rnum,
        board_num,
        board_title,
        board_cate,
        TO_CHAR(board_createdDate, 'YYYY.MM.DD') AS board_date,
        member.member_num,
        member.member_name
        FROM board
        INNER JOIN member ON board.member_num = member.member_num
        WHERE board.board_cate = #{cate} AND board_title LIKE '%' || #{keyword} || '%'
        <include refid="common.pagingPre"/>
    </select>

    <!-- 글 추가 -->
    <insert id="insertBoard" parameterType="hashmap">
        <![CDATA[
        INSERT INTO BOARD
        (member_num,
         board_title,
         board_content,
         board_cate)
        VALUES (#{member_num},
                #{board_title},
                #{BOARD_CONTENT},
                #{board_cate})
        ]]>
    </insert>

    <!-- 글 수정 -->
    <update id="updateBoard" parameterType="hashmap">
        <![CDATA[
        UPDATE board
        SET board_title   = #{board_title},
            board_content = #{board_content},
            board_cate    = #{board_cate}
        WHERE board_num = #{board_num}
        ]]>
    </update>

    <!-- 글 삭제 -->
    <delete id="deleteBoard" parameterType="hashmap">
        <![CDATA[
        DELETE
        FROM board
        WHERE board_num = #{board_num}
        ]]>
    </delete>

    <!-- 댓글 추가 -->
    <insert id="insertComment" parameterType="hashmap">
        <![CDATA[
        INSERT INTO comment
        (board_num,
         comment_content)
        values (#{board_num},
                #{comment_content})
        ]]>
    </insert>

    <!-- 댓글 수정 -->
    <update id="updateComment" parameterType="hashmap">
        <![CDATA[
        UPDATE comment
        SET comment_content = #{comment_content}
        WHERE board_num = #{board_num}
        ]]>
    </update>

    <!-- 댓글 삭제 -->
    <delete id="deleteComment" parameterType="hashmap">
        <![CDATA[
        DELETE
        FROM comment
        WHERE comment_num = #{comment_num}
        ]]>
    </delete>
</mapper>