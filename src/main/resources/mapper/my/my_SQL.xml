<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="my">
    <!-- 로그인 한 회원의 정보 출력 (마이페이지 회원정보 수정) -->
    <select id="memberModify" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
        SELECT MEMBER_NUM,
               MEMBER_ID,
               MEMBER_NAME,
               MEMBER_NICKNAME,
               MEMBER_PASSWD,
               MEMBER_EMAIL,
               MEMBER_RANK,
               TO_CHAR(MEMBER_REGDATE, 'YYYY/MM/DD')  MEMBER_REGDATE,
               TO_CHAR(MEMBER_LASTDATE, 'YYYY/MM/DD') MEMBER_LASTDATE,
               MEMBER_DELETE,
               MEMBER_VISITCOUNT
        FROM MEMBER
        WHERE MEMBER_ID = #{MEMBER_ID}
        ]]>
	</select>

    <!-- 회원정보 수정 전 비밀번호 확인 -->
    <select id="passwdCheck" parameterType="hashMap" resultType="String">
	<![CDATA[
        SELECT MEMBER_ID
        FROM MEMBER
        WHERE MEMBER_PASSWD = #{MEMBER_PASSWD}
          AND MEMBER_ID = #{MEMBER_ID}
        ]]>
	</select>

    <!-- 비밀번호 변경, 회원정보 업데이트 -->
    <update id="passwdChange" parameterType="hashmap">
        UPDATE MEMBER SET
        MEMBER_NAME = #{MEMBER_NAME},
        <if test="MEMBER_NEWPASSWD != null and MEMBER_NEWPASSWD != ''">
            MEMBER_PASSWD = #{MEMBER_NEWPASSWD}
        </if>
        WHERE
        MEMBER_NUM = #{MEMBER_NUM}
    </update>

    <update id="memberDelete">
        UPDATE MEMBER
        SET MEMBER_DELETE = true
        WHERE MEMBER_ID = #{MEMBER_ID}
    </update>

    <!-- 게시글 좋아요 목록 -->
    <select id="boardLikeList" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
        SELECT b.*
        FROM `board` b
                 INNER JOIN `like` l ON b.`board_num` = l.`board_num`
        WHERE l.member_num = #{member_num}
        ]]>
	</select>

    <!-- 댓글 목록 -->
    <select id="commentList" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
        SELECT b.*
        FROM `board` b
                 INNER JOIN `comment` c ON b.`board_num` = c.`board_num`
        WHERE c.`member_num` = #{member_num}
        ]]>
	</select>


</mapper>